#!/bin/bash

################################################################################
# Script to restore a local environment from a backup.
#
# This will list all available backups and ask you what backup to restore from.
#
# This will restore:
# - The database.
# - The /web directory.
#
# ! Do not change this file !
# All configuration is in the config directory
################################################################################


# Bootstrap the script.
source $(dirname $0)/src/bootstrap.sh


# Show script information.
echo
markup_h1_devider
markup_h1 " ${LWHITE}Restore${LBLUE} website ${WHITE}$SITE_NAME"
markup_h1_devider
markup_h1 " This will restore:"
markup_h1_li "The database."
markup_h1_li "The /web directory."
if [ ! -z "$SCRIPT_ARGUMENT" ]; then
  echo
  markup_h1 " The backup will be restored from backup/${LWHITE}$SCRIPT_ARGUMENT${LBLUE}"
fi
markup_h1_devider
echo


# Confirm deletion of files & DB.
if [ $CONFIRMED -ne 1 ]; then
  read -p "Are you sure? (y/N) " -n 1 -r
  echo

  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    markup_warning "! Restore aborted"
    echo
    exit 1
  fi
  echo
fi


# Change the working directory.
cd "$DIR_ROOT"


# Run script steps.
source "$DIR_SRC/script_before.sh"
source "$DIR_SRC/restore.sh"
source "$DIR_SRC/drupal_login.sh"
source "$DIR_SRC/script_after.sh"


# Go back from where this script was called.
cd "$DIR_CURRENT"


# Finish message.
markup_h1_devider
markup_success " Finished"
markup_h1_devider
markup_h1_li "Site Code : ${LWHITE}$DIR_WEB${RESTORE}"
markup_h1_li "Site URL  : ${LWHITE}$SITE_URL${RESTORE}"
markup_h1_devider
echo


exit 0
